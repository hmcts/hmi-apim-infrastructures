<policies>
    <inbound>
        <base />
        <choose>
            <when condition="@(context.Request.Headers.GetValueOrDefault("Destination-System","") == "SNL")">
                <include-fragment fragment-id="hmi-snl-auth-token-generation" />
                <rewrite-uri template="/" copy-unmatched-params="true" />
                <include-fragment fragment-id="hmi-snl-headers" />
                <set-backend-service base-url="https://#sAndLHost#/rest/hmcts/resources/sessions" />
            </when>
            <when condition="@(context.Request.Headers.GetValueOrDefault("Destination-System","") == "MOCK")">
                <return-response>
                    <set-status code="200" />
                    <set-header name="Content-Type" exists-action="override">
                        <value>application/json</value>
                    </set-header>
                    <set-body>
                    {
                        "sessionsResponse": {
                            "sessionCount": 3,
                            "sessions": [
                                {
                                    "sessionIdCaseHQ": "446902289",
                                    "sessionUrl": "https://sit.list-assist.service.justice.gov.uk/casehqsit/vue/Html5ResourceScheduler/loadHearingSchedule.action?venueBookingId=446902289",
                                    "sessionStatus": {
                                        "code": "5",
                                        "description": "Released"
                                    },
                                    "sessionType": {
                                        "code": "CS",
                                        "description": "Civil"
                                    },
                                    "sessionPanelType": "Adult",
                                    "sessionBulkBooking": false,
                                    "sessionOverBooking": false,
                                    "sessionCluster": {
                                        "code": "HSY",
                                        "description": "Humber South Yorkshire"
                                    },
                                    "sessionVenue": {
                                        "locationIdCaseHQ": "1050",
                                        "locationName": "Sheffield Combined Court Centre",
                                        "locationRegion": {
                                            "code": "3",
                                            "description": "North East"
                                        },
                                        "locationCluster": {
                                            "code": "HSY",
                                            "description": "Humber South Yorkshire"
                                        },
                                        "locationReferences": [
                                            {
                                                "key": "EXTERNAL",
                                                "value": "1050"
                                            }
                                        ]
                                    },
                                    "sessionRoom": {
                                        "locationIdCaseHQ": "1070",
                                        "locationName": "Sheffield CCC Hearing Room 2",
                                        "locationDummyFlag": false,
                                        "locationVirtualFlag": false,
                                        "locationRegion": {
                                            "code": "3",
                                            "description": "North East"
                                        },
                                        "locationCluster": {
                                            "code": "HSY",
                                            "description": "Humber South Yorkshire"
                                        },
                                        "locationReferences": [
                                            {
                                                "key": "EXTERNAL",
                                                "value": "1070"
                                            }
                                        ]
                                    },
                                    "sessionStartTime": "2022-02-02T10:00:00Z",
                                    "sessionDuration": 360,
                                    "sessionBreakDuration": 0,
                                    "sessionDurationUsed": 0,
                                    "sessionDurationAvailable": 360,
                                    "sessionSlotDuration": 360,
                                    "sessionSlots": 1,
                                    "sessionSlotsUsed": 0,
                                    "sessionSlotsAvailable": 1,
                                    "sessionJohs": []
                                },
                                {
                                    "sessionIdCaseHQ": "446924511",
                                    "sessionUrl": "https://sit.list-assist.service.justice.gov.uk/casehqsit/vue/Html5ResourceScheduler/loadHearingSchedule.action?venueBookingId=446924511",
                                    "sessionStatus": {
                                        "code": "5",
                                        "description": "Released"
                                    },
                                    "sessionType": {
                                        "code": "CS",
                                        "description": "Civil"
                                    },
                                    "sessionPanelType": "Adult",
                                    "sessionBulkBooking": false,
                                    "sessionOverBooking": false,
                                    "sessionCluster": {
                                        "code": "HSY",
                                        "description": "Humber South Yorkshire"
                                    },
                                    "sessionVenue": {
                                        "locationIdCaseHQ": "1050",
                                        "locationName": "Sheffield Combined Court Centre",
                                        "locationRegion": {
                                            "code": "3",
                                            "description": "North East"
                                        },
                                        "locationCluster": {
                                            "code": "HSY",
                                            "description": "Humber South Yorkshire"
                                        },
                                        "locationReferences": [
                                            {
                                                "key": "EXTERNAL",
                                                "value": "1050"
                                            }
                                        ]
                                    },
                                    "sessionRoom": {
                                        "locationIdCaseHQ": "1072",
                                        "locationName": "Sheffield CCC Hearing Room 4",
                                        "locationDummyFlag": false,
                                        "locationVirtualFlag": false,
                                        "locationRegion": {
                                            "code": "3",
                                            "description": "North East"
                                        },
                                        "locationCluster": {
                                            "code": "HSY",
                                            "description": "Humber South Yorkshire"
                                        },
                                        "locationReferences": [
                                            {
                                                "key": "EXTERNAL",
                                                "value": "1072"
                                            }
                                        ]
                                    },
                                    "sessionStartTime": "2022-02-02T10:00:00Z",
                                    "sessionDuration": 360,
                                    "sessionBreakDuration": 0,
                                    "sessionDurationUsed": 0,
                                    "sessionDurationAvailable": 360,
                                    "sessionSlotDuration": 60,
                                    "sessionSlots": 6,
                                    "sessionSlotsUsed": 0,
                                    "sessionSlotsAvailable": 6,
                                    "sessionJohs": []
                                }
                            ]
                        }
                    }
                    </set-body>
                </return-response>
            </when>
            <otherwise>
                <include-fragment fragment-id="hmi-invalid-destination-response" />
            </otherwise>
        </choose>
    </inbound>
    <backend>
        <base />
    </backend>
    <outbound>
        <base />
         <choose>
             <when condition="@(context.Response.StatusCode == 401 || context.Response.StatusCode == 403)">
                 <cache-remove-value key="snlAuth" />
                 <include-fragment fragment-id="hmi-failed-destination-authentication-response" />
            </when>
        </choose>
    </outbound>
    <on-error>
        <base />
    </on-error>
</policies>
